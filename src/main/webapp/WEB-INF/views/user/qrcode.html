<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/base}">
<head>
<title>[[#{title.user}]]</title>
<script th:src="@{/js/qrcode.js}"></script>
<style>
html {
	height: 100%;
}
</style>
<script>
	function createQRcdoe(img, txt) {
		var qrcode = new QRCode(-1, QRErrorCorrectLevel.H);
		qrcode.addData(txt);
		qrcode.make();

		var canvas = document.createElement('canvas');
		canvas.width = img.width;
		canvas.height = img.height;
		var ctx = canvas.getContext('2d');
		var tileW = canvas.width / qrcode.getModuleCount();
		var tileH = canvas.height / qrcode.getModuleCount();
		for (var row = 0; row < qrcode.getModuleCount(); row++) {
			for (var col = 0; col < qrcode.getModuleCount(); col++) {
				ctx.fillStyle = qrcode.isDark(row, col) ? '#000000' : '#ffffff';
				var w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));
				var h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));
				ctx.fillRect(Math.round(col * tileW), Math.round(row * tileH),
						w, h);
			}
		}
		img.src = canvas.toDataURL("image/png");
	}
</script>
</head>
<body layout:fragment="body"
	class="pt-header pb-footer d-flex align-items-center">
	<header layout:insert="~{layout/parts/header::user(-1)}"
		class="fixed-top bg-header"></header>
	<th:block layout:replace="~{layout/parts/dialog::logout}" />

	<th:block layout:replace="~{layout/parts/dialog::waiting}" />
	<div class="container bg-main my-auto">
		<div class="mx-auto">
			<div>
				<img id="qrcode" width="120" height="120" alt="QRcdoe" />
			</div>
			<div>
				url:<span th:text="${loginurl}"></span>
			</div>
			<div>
				username:<span th:text="${qrcode.guest}"></span>
			</div>
			<div>
				password:<span th:text="${qrcode.guest}"></span>
			</div>
			<div>
				password:<span th:text="${qrcode.expiredt}"></span>
			</div>
			<div>
				<a class="btn btn-primary" th:href="@{/user/home}" role="button">Back
					to Top</a>
			</div>
		</div>
	</div>
	<script>
		createQRcdoe($('#qrcode').get(0), '[(${qrcodeurl})]');
	</script>
</body>
</html>